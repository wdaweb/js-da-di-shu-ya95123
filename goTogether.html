<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天堂見 We will see in Heaven</title>
    <!-- css reset -->
    <link rel="stylesheet" href="/css/reset.css">
    <!-- 連結 css 樣式 -->
    <link rel="stylesheet" href="/css/goTogether.css">
</head>

<body>
    <div id="top">
        <p id="text-timeleft">30 s</p>
        <p id="text-score">Score：0 分</p>
        <div id="picExframe">
            <table>
                <tr>
                    <td class="exLeft" rowspan="2"><img class="picEx" src="/images/fish.png" alt="fish">
                    </td>
                    <td class="exCalc red">+1分</td>
                    <td class="exLeft" rowspan="2"><img class="picEx" src="/images/sad-people.png" alt="sad-people">
                    </td>
                    <td class="exCalc red">+3分</td>
                    <td class="exLeft" rowspan="2"><img class="picEx" src="/images/sushi.png" alt="sushi"></td>
                    <td class="exCalc red">+0分</td>
                    <td class="exLeft" rowspan="2"><img class="picEx" src="/images/egg.png" alt="egg"></td>
                    <td class="exCalc red">+5分</td>
                    <td class="exLeft" rowspan="2"><img class="picEx" src="/images/red-evil.png" alt="red-evil"></td>
                    <td class="exCalc">-1分</td>
                    <td class="exLeft" rowspan="2"><img class="picEx" src="/images/yellow-evil.png" alt="yellow-evil">
                    </td>
                    <td class="exCalc">-2分</td>
                </tr>
                <tr>
                    <td class="exCalc red">+1秒</td>
                    <td class="exCalc red">+0秒</td>
                    <td class="exCalc red">+2秒</td>
                    <td class="exCalc red">+0秒</td>
                    <td class="exCalc">-0秒</td>
                    <td class="exCalc">-1秒</td>
                </tr>
            </table>
        </div>
        <!-- <div id="picExframe">
            <div><img class="picEx" src="/images/fish.png" alt="fish"></div>
            <div><img class="picEx" src="/images/sad-people.png" alt="sad-people"></div>
            <div><img class="picEx" src="/images/sushi.png" alt="sushi"></div>
            <div><img class="picEx" src="/images/egg.png" alt="egg"></div>
            <div><img class="picEx" src="/images/red-evil.png" alt="red-evil"></div>
            <div><img class="picEx" src="/images/yellow-evil.png" alt="yellow-evil"></div>
        </div> -->
    </div>

    <div id="left">
        <p class="sideP">排行榜</p>
        <!-- 設空陣列，用迴圈跑1-7 放進陣列，有比第七名高，就creatElement讓其顯示 -->
        <div>
            <span class="text-ranknum">1&ensp;</span>
            <span class="text-rankplayer">NewPlayer</span>
            <span class="text-rankscore">70</span>
        </div>

    </div>

    <div id="right">
        <p class="sideP">工具</p>
    </div>

    <div id="middle">
        <table id="gameFrame" border="1">
            <tr>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
            </tr>
            <tr>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
            </tr>
            <tr>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
            </tr>
            <tr>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
            </tr>
            <tr>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
                <td><img src="" alt="" class="hole"></td>
            </tr>
        </table>
    </div>

    <div id="btn-start">Go</div>

    <script>
        // top 剩餘時間、當前分數
        const textTime = document.getElementById("text-timeleft");
        const textScore = document.getElementById("text-score");

        // middle 遊戲畫面、地洞
        const gameFrame = document.getElementById("gameFrame");
        const holes = document.getElementsByClassName("hole");
        const btnStart = document.getElementById("btn-start");

        // left
        const textRankNum = document.getElementsByClassName("text-ranknum");
        const textRankPlayer = document.getElementsByClassName("text-rankplayer");
        const textRankScore = document.getElementsByClassName("text-rankscore");

        // 隨機數 function
        const rand = (min, max) => {
            return Math.round(Math.random() * (max - min) + min);
        }

        // 圖片插入區
        let imgFish = "/images/fish.png";
        let imgSad = "/images/sad-people.png";
        let imgSushi = "/images/sushi.png";
        let imgEgg = "/images/egg.png";
        let imgRedEvil = "/images/red-evil.png";
        let imgYellowEvil = "/images/yellow-evil.png";
        // 圖片出現產生不同機率用
        let imgp = 0;
        // const imgs = [imgFish, imgSad, imgSushi, imgEgg, imgRedEvil, imgYellowEvil];

        // 遊戲變數基本設定區
        let score = 0;
        let inGame = false;
        let timeLeft = 30;
        let timer = 0;
        let gameRound = 0;
        let randJump = 0;
        let jumps = [];
        let rankScore = { name: '', score: 0 };
        let storage = JSON.parse(localStorage.getItem("rankScore"));
        // TODO 要再設定 rank 的分數比較

        btnStart.onclick = () => {
            // 讓btnStart 消失
            btnStart.style.display = "none";
            // 開始遊戲
            inGame = true;
            // 重置分數、起始時間
            score = 0;
            textScore.innerText = `Score：${score} 分`;
            timeLeft = 5;
            textTime.innerText = `${timeLeft} s`;

            timer = setInterval(timeDes, 1000);
            gameRound = setInterval(game, 2500);
            game();
        }

        // 時間線控制
        const timeDes = () => {
            // 遞減時間
            timeLeft--;
            textTime.innerText = `${timeLeft} s`;

            if (timeLeft <= 0) {
                inGame = false;
                clearInterval(timer);
                clearInterval(gameRound);
                // 清空圖片
                for (let hole of holes) {
                    hole.src = "";
                }
                // setTimeout 為了讓秒數跑到 0s
                setTimeout(() => {
                    // TODO 把alert設定改好看 用div跳
                    alert(`你獲得了 ${score} 分`);

                    // 讓 btn 出現，原本css設flex，所以這裡也要調回flex，不然會跑版
                    btnStart.style.display = "flex";

                    // 讓剩餘時間調回來
                    timeLeft = 30;
                    textTime.innerText = `${timeLeft} s`;

                    // TODO 設定排行榜填寫機制
                }, 100)
            }
        }

        // 遊戲進行
        const game = () => {
            // 清空 hole 圖片
            for (let hole of holes) {
                hole.src = "";
            }
            // 重置 jumps隨機格子陣列、imgp圖片機率
            jumps = [];
            imgp = 0;

            // 隨機選7格跳圖片
            for (let i = 0; i < 7; i++) {
                // 隨機不重複
                randJump = rand(0, 34);
                while (jumps.includes(randJump)) {
                    randJump = rand(0, 34);
                }
                jumps.push(randJump);

                // 已被選的隨機格子，再隨機選圖片跳出
                imgp = rand(1, 100);
                console.log(imgp);
                if (imgp > 0 && imgp <= 30) {
                    // 魚 30%
                    holes[jumps[i]].src = imgFish;
                }
                else if (imgp > 30 && imgp <= 60) {
                    // 難過 30%
                    holes[jumps[i]].src = imgSad;
                }
                else if (imgp > 60 && imgp <= 67) {
                    // 壽司 7%
                    holes[jumps[i]].src = imgSushi;
                }
                else if (imgp > 67 && imgp <= 70) {
                    // 彩蛋 3%
                    holes[jumps[i]].src = imgEgg;
                }
                else if (imgp > 70 && imgp <= 85) {
                    // 紅惡 15%
                    holes[jumps[i]].src = imgRedEvil;
                }
                else if (imgp > 85 && imgp <= 100) {
                    // 黃惡 15%
                    holes[jumps[i]].src = imgYellowEvil;
                }
            }
        }

        // 遊戲點擊事件&分數、時間
        for (let hole of holes) {
            hole.onclick = () => {
                // 魚 +1分 +1秒
                if (inGame && hole.src.includes(imgFish)) {
                    console.log(hole.src);
                    score++;
                    textScore.innerText = `Score：${score} 分`;
                    timeLeft++;
                    textTime.innerText = `${timeLeft} s`;
                }
                // 難過 +3分
                else if (inGame && hole.src.includes(imgSad)) {
                    score += 3;
                    textScore.innerText = `Score：${score} 分`;
                }
                // 壽司 +2秒
                else if (inGame && hole.src.includes(imgSushi)) {
                    timeLeft += 2;
                    textTime.innerText = `${timeLeft} s`;
                }
                // 彩蛋 +5分
                else if (inGame && hole.src.includes(imgEgg)) {
                    score += 5;
                    textScore.innerText = `Score：${score} 分`;
                }
                // 紅惡 -1分
                else if (inGame && hole.src.includes(imgRedEvil)) {
                    score--;
                    textScore.innerText = `Score：${score} 分`;
                }
                // 黃惡 -2分 -1秒
                else if (inGame && hole.src.includes(imgYellowEvil)) {
                    score -= 2;
                    textScore.innerText = `Score：${score} 分`;
                    timeLeft--;
                    textTime.innerText = `${timeLeft} s`;
                }
            }
        }
    </script>

</body>

</html>